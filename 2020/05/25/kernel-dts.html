<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		



		<title>Linux DTB -- device tree</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../../../../assets/css/main.css" />
		<link rel="stylesheet" href="../../../../assets/css/syntax.css">
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">
						<div class="inner">

							<!-- Header -->
																  <script type="text/x-mathjax-config">
								    MathJax.Hub.Config({
								      tex2jax: {
								        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
								        inlineMath: [['$','$']]
								      }
								    });
								  </script>
								  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>


								<header id="header">
									<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
									<a href="../../../../index.html" class="logo"><strong>Follow Jietang</strong> with:</a>
									<ul class="icons">
										<li><a href="mailto:alvin.tang6@gmail.com" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
										
										<!--<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li> -->
										<li><a href="https://github.com/Alvintang6" class="icon brands fa-github-square"><span class="label">Github</span></a></li>
										<li><a href="https://www.instagram.com/tang12y/?hl=en" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
										<li><a href="https://www.linkedin.com/in/jie-tang-55070b148/" class="icon brands fa-linkedin-in"><span class="label">Linkedin</span></a></li>
										<li><a href="../../../../resume_jietang.pdf" class="logo"><i class="fas fa-file-invoice"></i>CV</a></li>
									</ul>
								</header>


							


								

							<!-- Content -->
								<section>
									<header class="main">
										<h1>Linux DTB -- device tree</h1>
										<p>25 May 2020</p>
									</header>
									
									<p style="float:right"><a href=" ../../../..//chinese/dts.html" >中文连接</a></p>

									 
									


									<h3><i class="fas fa-tags"></i>Post Tags</h3>
									
									<a href=" ../../../../tag/linux/index.html" >Linux</a>
									
									<a href=" ../../../../tag/kernel/index.html" >kernel</a>
									
									<a href=" ../../../../tag/device-tree/index.html" >Device-tree</a>
									
									<br/>
									<br/>

									<ul id="markdown-toc">
  <li><a href="#1-device-build" id="markdown-toc-1-device-build">1. Device Build</a></li>
  <li><a href="#2-device-tree-grammar" id="markdown-toc-2-device-tree-grammar">2. Device tree grammar</a></li>
  <li><a href="#3-some-specical-node" id="markdown-toc-3-some-specical-node">3. Some specical node</a></li>
  <li><a href="#4-property" id="markdown-toc-4-property">4. Property</a></li>
  <li><a href="#5-of-function" id="markdown-toc-5-of-function">5. “of” function</a></li>
  <li><a href="#6-match-between-device-and-drive" id="markdown-toc-6-match-between-device-and-drive">6. Match between device and drive</a>    <ul>
      <li><a href="#61-device-tree-device-match-with-driver" id="markdown-toc-61-device-tree-device-match-with-driver">6.1 Device tree device match with driver</a></li>
    </ul>
  </li>
  <li><a href="#7-pinctrl--giop-subsystem" id="markdown-toc-7-pinctrl--giop-subsystem">7. Pinctrl &amp; GIOP subsystem</a>    <ul>
      <li><a href="#71-pinctrl" id="markdown-toc-71-pinctrl">7.1. Pinctrl:</a></li>
      <li><a href="#72-pinctrl-driver" id="markdown-toc-72-pinctrl-driver">7.2 pinctrl driver:</a></li>
      <li><a href="#73-gpio-subsystem" id="markdown-toc-73-gpio-subsystem">7.3. GPIO subsystem</a>        <ul>
          <li><a href="#gpio-ranges" id="markdown-toc-gpio-ranges">gpio-ranges</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="1-device-build">1. Device Build</h2>

<p>At <code class="highlighter-rouge">/linux-x.x.xx</code> file path using <code class="highlighter-rouge">make xxx.dtb</code> to compile device tree binary only.<br />
To build customized dts adding the corresponding name in <code class="highlighter-rouge">/linux-x.x.xx/arch/arm/boot/dts/Makefile</code>.</p>

<h2 id="2-device-tree-grammar">2. Device tree grammar</h2>

<ul>
  <li>dts beginning from <code class="highlighter-rouge">/</code>.</li>
  <li>dts may include header <code class="highlighter-rouge">dtsi</code> which means some common device feature shared with certain SOC.</li>
  <li>Using <code class="highlighter-rouge">$</code> symbol to append device in configured dts file.</li>
  <li>node defination format: 
label: node-name@reg-address 
  we can use <code class="highlighter-rouge">&amp;label </code> to quick acess the node to append some devices.
  Most of the time the reg-address is the start address of register. It might also be device nums or some thing also, etc: like i2c device number:</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">&amp;</span><span class="n">i2c1</span> <span class="p">{</span>
	<span class="n">clock</span><span class="o">-</span><span class="n">frequency</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">100000</span><span class="o">&gt;</span><span class="p">;</span>
	<span class="n">pinctrl</span><span class="o">-</span><span class="n">names</span> <span class="o">=</span> <span class="s">"default"</span><span class="p">;</span>
	<span class="n">pinctrl</span><span class="o">-</span><span class="mi">0</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">pinctrl_i2c1</span><span class="o">&gt;</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="s">"okay"</span><span class="p">;</span>

	<span class="n">mag3110</span><span class="err">@</span><span class="n">e</span> <span class="p">{</span>
		<span class="n">compatible</span> <span class="o">=</span> <span class="s">"fsl,mag3110"</span><span class="p">;</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0xe</span><span class="o">&gt;</span><span class="p">;</span>
		<span class="n">position</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">;</span>
	<span class="p">};</span>

	<span class="n">fxls8471</span><span class="err">@</span><span class="mi">1</span><span class="n">e</span> <span class="p">{</span>
		<span class="n">compatible</span> <span class="o">=</span> <span class="s">"fsl,fxls8471"</span><span class="p">;</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0x1e</span><span class="o">&gt;</span><span class="p">;</span>
		<span class="n">position</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
		<span class="n">interrupt</span><span class="o">-</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">gpio5</span><span class="o">&gt;</span><span class="p">;</span>
		<span class="n">interrupts</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span> <span class="mi">8</span><span class="o">&gt;</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">};</span>

</code></pre></div></div>

<h2 id="3-some-specical-node">3. Some specical node</h2>
<ul>
  <li>
    <p>aliases</p>
  </li>
  <li>
    <p>chosen
 Uboot bootargs</p>
  </li>
</ul>

<h2 id="4-property">4. Property</h2>

<ul>
  <li>compatible: The compatible board module can use
<code class="highlighter-rouge">compatible</code> will compare the property with ‘arch/xxx/mash-xxx’
and see if any label match with DT_MACHINE_START().</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">imx53_dt_board_compat</span><span class="p">[]</span> <span class="n">__initconst</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">"fsl,imx53"</span><span class="p">,</span>
	<span class="nb">NULL</span>
<span class="p">};</span>

<span class="n">DT_MACHINE_START</span><span class="p">(</span><span class="n">IMX53_DT</span><span class="p">,</span> <span class="s">"Freescale i.MX53 (Device Tree Support)"</span><span class="p">)</span>
	<span class="p">.</span><span class="n">init_early</span>	<span class="o">=</span> <span class="n">imx53_init_early</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_machine</span>	<span class="o">=</span> <span class="n">imx53_dt_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_late</span>	<span class="o">=</span> <span class="n">imx53_init_late</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dt_compat</span>	<span class="o">=</span> <span class="n">imx53_dt_board_compat</span><span class="p">,</span>
<span class="n">MACHINE_END</span>

</code></pre></div></div>

<ul>
  <li>model: exactly name of the module</li>
  <li>#address-cells  &amp; #size-cells 
This two properties will influence the format of <reg> in subnodes:
For example:</reg></li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">spi4</span><span class="p">{</span>
	<span class="cp">#address-cells = &lt;1&gt;; 
</span>	<span class="cp">#size-cells = &lt;1&gt;;
</span>	
	<span class="n">xxx</span><span class="p">{</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0x10000000</span> <span class="mh">0x1000</span><span class="o">&gt;</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="n">i2c4</span><span class="p">{</span>
	<span class="cp">#address-cells = &lt;1&gt;; 
</span>	<span class="cp">#size-cells = &lt;0&gt;;
</span>	
	<span class="n">mag3110</span><span class="err">@</span><span class="n">e</span><span class="p">{</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0x1e</span><span class="o">&gt;</span><span class="p">;</span> 
	<span class="p">}</span> 
<span class="p">}</span>

</code></pre></div></div>
<ul>
  <li>ranges: address mapping
blank when there is no address mapping from child-bus-address to parent-bus-address
For example:</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">soc</span><span class="p">{</span>
	<span class="p">...</span>
	<span class="n">ranges</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0x0</span> <span class="mh">0xe0000000</span> <span class="mh">0x00100000</span><span class="o">&gt;</span><span class="p">;</span>


	<span class="n">serial</span><span class="p">{</span>
		<span class="p">...</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0x4600</span> <span class="mh">0x100</span><span class="o">&gt;</span><span class="p">;</span>
		<span class="p">...</span>
	<span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>
<p>With this mapping serial device node would be remapped at address 0xe0004600.</p>

<ul>
  <li>name:</li>
  <li>
    <p>device_type: mostly in “cpu”,”mem”</p>
  </li>
  <li>Tips: Reference document: 
Document/devicetree/bindings/xxx</li>
</ul>

<h2 id="5-of-function">5. “of” function</h2>

<p>In linux system lib, a series “of” function are provided to obtain the node information from the device tree.</p>

<ul>
  <li>struct device_node *of_find_node_by_path(const char *path);</li>
  <li>struct device_node *of_find_node_by_name(struct device_node *from,const char *name);</li>
  <li>struct device_node *of_find_node_by_type(struct device_node *from,const char *type);
……</li>
</ul>

<p>The return structure <code class="highlighter-rouge">device_node</code> is defined in the following:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">device_node</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>  <span class="c1">// node name</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">type</span><span class="p">;</span>  <span class="c1">// device type</span>
    <span class="n">phandle</span> <span class="n">phandle</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">full_name</span><span class="p">;</span> <span class="c1">// full name</span>
    <span class="k">struct</span> <span class="n">fwnode_handle</span> <span class="n">fwnode</span><span class="p">;</span>

    <span class="k">struct</span>  <span class="n">property</span> <span class="o">*</span><span class="n">properties</span><span class="p">;</span> <span class="c1">// property</span>
    <span class="k">struct</span>  <span class="n">property</span> <span class="o">*</span><span class="n">deadprops</span><span class="p">;</span>    <span class="cm">/* removed properties */</span>
    <span class="k">struct</span>  <span class="n">device_node</span> <span class="o">*</span><span class="n">parent</span><span class="p">;</span> <span class="c1">// parent node </span>
    <span class="k">struct</span>  <span class="n">device_node</span> <span class="o">*</span><span class="n">child</span><span class="p">;</span>  <span class="c1">// child node</span>
    <span class="k">struct</span>  <span class="n">device_node</span> <span class="o">*</span><span class="n">sibling</span><span class="p">;</span>
<span class="cp">#if defined(CONFIG_OF_KOBJ)
</span>    <span class="k">struct</span>  <span class="n">kobject</span> <span class="n">kobj</span><span class="p">;</span>
<span class="cp">#endif
</span>    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">_flags</span><span class="p">;</span>
    <span class="kt">void</span>    <span class="o">*</span><span class="n">data</span><span class="p">;</span>
<span class="cp">#if defined(CONFIG_SPARC)
</span>    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path_component_name</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">unique_id</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">of_irq_controller</span> <span class="o">*</span><span class="n">irq_trans</span><span class="p">;</span>
<span class="cp">#endif
</span><span class="p">};</span>

</code></pre></div></div>

<ul>
  <li>struct property *of_find_property(const struct device_node *np,const char *name,int *lenp)</li>
</ul>

<p>Properties node is listed :</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">struct</span> <span class="n">property</span> <span class="p">{</span>
    <span class="kt">char</span>    <span class="o">*</span><span class="n">name</span><span class="p">;</span>  <span class="c1">// property name</span>
    <span class="kt">int</span>     <span class="n">length</span><span class="p">;</span>     <span class="c1">// property length</span>
    <span class="kt">void</span>    <span class="o">*</span><span class="n">value</span><span class="p">;</span> <span class="c1">// property value</span>
    <span class="k">struct</span> <span class="n">property</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span> 
<span class="cp">#if defined(CONFIG_OF_DYNAMIC) || defined(CONFIG_SPARC)
</span>    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">_flags</span><span class="p">;</span>
<span class="cp">#endif
#if defined(CONFIG_OF_PROMTREE)
</span>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">unique_id</span><span class="p">;</span>
<span class="cp">#endif
#if defined(CONFIG_OF_KOBJ)
</span>    <span class="k">struct</span> <span class="n">bin_attribute</span> <span class="n">attr</span><span class="p">;</span>
<span class="cp">#endif
</span><span class="p">};</span>

</code></pre></div></div>

<p>For reading the properties linux provide the function:</p>

<ul>
  <li>if the property is a array:</li>
  <li>
    <p>int of_property_read_uXX_array(const struct device_node *np, const char *propname, u32 *out_values, size_t sz) (XX = 8 16 32 64)</p>
  </li>
  <li>if the property is int:</li>
  <li>
    <p>int of_property_read_uXX (const struct device_node *np, const char *propname,u8 *out_values)(XX = 8 16 32 64)</p>
  </li>
  <li>if the string:</li>
  <li>int of_property_read_string(const struct device_node *np,const char *propname, const char **out_string)</li>
</ul>

<h2 id="6-match-between-device-and-drive">6. Match between device and drive</h2>

<h3 id="61-device-tree-device-match-with-driver">6.1 Device tree device match with driver</h3>
<p>device tree matching driver will use of_match_table. The of_match_table should be define inside other structure.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">of_device_id</span> <span class="n">rgb_led</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{.</span><span class="n">compatible</span> <span class="o">=</span> <span class="s">"fire,rgb_led"</span><span class="p">},</span>
	<span class="p">{</span><span class="cm">/* sentinel */</span><span class="p">}};</span>

<span class="k">struct</span> <span class="n">platform_driver</span> <span class="n">led_platform_driver</span> <span class="o">=</span> <span class="p">{</span>
<span class="p">.</span><span class="n">driver</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"rgb-leds-platform"</span><span class="p">,</span>
		<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">of_match_table</span> <span class="o">=</span> <span class="n">rgb_led</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="7-pinctrl--giop-subsystem">7. Pinctrl &amp; GIOP subsystem</h2>

<h3 id="71-pinctrl">7.1. Pinctrl:</h3>

<p>Pinctrl system is just other device tree nodes but under iomuxc node.</p>

<p>For example create a rgb led device tree using GPIO1_IO04, GPIO4_IO20, GPIO4_IO19:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">&amp;</span><span class="n">iomuxc</span> <span class="p">{</span>
    <span class="n">pinctrl</span><span class="o">-</span><span class="n">names</span> <span class="o">=</span> <span class="s">"default"</span><span class="p">;</span>
    <span class="n">pinctrl</span><span class="o">-</span><span class="mi">0</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">pinctrl_hog_1</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="nl">pinctrl_rgb_led:</span><span class="n">rgb_led</span><span class="p">{</span>
                    <span class="n">fsl</span><span class="p">,</span><span class="n">pins</span> <span class="o">=</span> <span class="o">&lt;</span>
                            <span class="n">MX6UL_PAD_GPIO1_IO04__GPIO1_IO04</span>        <span class="mh">0x000010B1</span>
                            <span class="n">MX6UL_PAD_CSI_HSYNC__GPIO4_IO20</span>         <span class="mh">0x000010B1</span>
                            <span class="n">MX6UL_PAD_CSI_VSYNC__GPIO4_IO19</span>         <span class="mh">0x000010B1</span>
                    <span class="o">&gt;</span><span class="p">;</span>
            <span class="p">};</span>

</code></pre></div></div>
<p>Here the <code class="highlighter-rouge">MX6UL_PAD_GPIO1_IO04__GPIO1_IO04</code> refers the register(MUX,PAD,INPUT) address related with GPIO1_IO04, and 0x00010B1 is the value written into PAD_CTL register.</p>

<ul>
  <li>Macro definition of Pin property:</li>
</ul>

<p>Some marco definition of IO-Pin property can be find in <code class="highlighter-rouge">/arch/arm/boot/dts/xxx-pinfun.h</code> 
 For example:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cm">/*
 * The pin function ID is a tuple of
 * &lt;mux_reg conf_reg input_reg mux_mode input_val&gt;
 */</span>

 <span class="cp">#define MX6UL_PAD_GPIO1_IO04__ENET1_REF_CLK1		0x006c 0x02f8 0x0574 0 1
</span> <span class="cp">#define MX6UL_PAD_GPIO1_IO04__PWM3_OUT			    0x006c 0x02f8 0x0000 1 0
</span> <span class="cp">#define MX6UL_PAD_GPIO1_IO04__USB_OTG1_PWR		    0x006c 0x02f8 0x0000 2 0
</span> <span class="cp">#define MX6UL_PAD_GPIO1_IO04__REF_CLK_24M		    0x006c 0x02f8 0x0000 3 0
</span> <span class="cp">#define MX6UL_PAD_GPIO1_IO04__USDHC1_RESET_B		0x006c 0x02f8 0x0000 4 0
</span> <span class="cp">#define MX6UL_PAD_GPIO1_IO04__GPIO1_IO04		    0x006c 0x02f8 0x0000 5 0
</span> <span class="cp">#define MX6UL_PAD_GPIO1_IO04__ENET2_1588_EVENT0_IN	0x006c 0x02f8 0x0000 6 0
</span> <span class="cp">#define MX6UL_PAD_GPIO1_IO04__UART5_DCE_TX		    0x006c 0x02f8 0x0000 8 0
</span> <span class="cp">#define MX6UL_PAD_GPIO1_IO04__UART5_DTE_RX		    0x006c 0x02f8 0x0644 8 2
</span>
</code></pre></div></div>

<p>Combining the iomuxc root node inside the <code class="highlighter-rouge">xxxx.dtsi</code> in the following:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
	<span class="n">iomuxc</span><span class="o">:</span> <span class="n">iomuxc</span><span class="err">@</span><span class="mf">20e0000</span> <span class="p">{</span>
				<span class="n">compatible</span> <span class="o">=</span> <span class="s">"fsl,imx6ul-iomuxc"</span><span class="p">;</span>
				<span class="n">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0x20e0000</span> <span class="mh">0x4000</span><span class="o">&gt;</span><span class="p">;</span>
			<span class="p">};</span>

</code></pre></div></div>
<p>The explanation of following field: <br />
 &lt;mux_reg conf_reg input_reg mux_mode input_val&gt;</p>
<ul>
  <li>
    <p>mux_reg:
This field indicated the offset of SW_MUX_CTL Register (multiplexer)<br />
Address: 20E_0000h base + 6Ch offset = 20E_006Ch</p>
  </li>
  <li>
    <p>conf_reg:
This field indicated the offset of SW_PAD_CTL Register (pads)<br />
Address: 20E_0000h base + 2F8h offset = 20E_02F8h</p>
  </li>
  <li>
    <p>input_reg:
This field indicated the offset of DATA_SELECT_INPUT DAISY Register.<br />
Take UART5_DTE_RX for example:
Address: 20E_0000h base + 644h offset = 20E_0644h</p>
  </li>
  <li>
    <p>mux_mode:
the value configured in MUX_CTL register 
0101 ALT5 — Select mux mode: ALT5 mux port: GPIO1_IO04 of instance: gpio</p>
  </li>
  <li>
    <p>input_val:
the value will be written into input_reg.</p>
  </li>
</ul>

<h3 id="72-pinctrl-driver">7.2 pinctrl driver:</h3>

<p>When pinctrl node compatible property match with the compatible member of platform device structure `  const struct of_device_id ` the .probe function which inside platform_device will be executed.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="nc">of_device_id</span> <span class="n">imx6ul_pinctrl_of_match</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="p">.</span><span class="n">compatible</span> <span class="o">=</span> <span class="s">"fsl,imx6ul-iomuxc"</span><span class="p">,</span> <span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">imx6ul_pinctrl_info</span><span class="p">,</span> <span class="p">},</span>
		<span class="p">{</span> <span class="p">.</span><span class="n">compatible</span> <span class="o">=</span> <span class="s">"fsl,imx6ull-iomuxc-snvs"</span><span class="p">,</span> <span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">imx6ull_snvs_pinctrl_info</span><span class="p">,</span> <span class="p">},</span>
		<span class="p">{</span> <span class="cm">/* sentinel */</span> <span class="p">}</span>
	<span class="p">};</span>


   <span class="k">static</span> <span class="k">struct</span> <span class="nc">platform_driver</span> <span class="n">imx6ul_pinctrl_driver</span> <span class="o">=</span> <span class="p">{</span>
	 <span class="p">.</span><span class="n">driver</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"imx6ul-pinctrl"</span><span class="p">,</span>
		<span class="p">.</span><span class="n">of_match_table</span> <span class="o">=</span> <span class="n">of_match_ptr</span><span class="p">(</span><span class="n">imx6ul_pinctrl_of_match</span><span class="p">),</span>
	 <span class="p">},</span>
	 <span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">imx6ul_pinctrl_probe</span><span class="p">,</span>
   <span class="p">};</span>

</code></pre></div></div>
<p>inside <code class="highlighter-rouge">imx_pinctrl_probe</code> a pinctrl_register function will register a pinctrl_desc structure.
 The pinctrl_desc contains all operations to configure the properties of ‘cpu’ or ‘mpu’ chips.
 like :</p>
<ul>
  <li>pinconf_set : set the Pads of pins.</li>
  <li>pmx_set : set the multiplex of pins.</li>
</ul>

<h3 id="73-gpio-subsystem">7.3. GPIO subsystem</h3>

<p>After we configured the pins as GPIO. The next step is setting some properties of our GPIO pins. Here the GPIO subsystem can be used to do this work.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>



</code></pre></div></div>

<h4 id="gpio-ranges">gpio-ranges</h4>
<p>The first number is the index of first pin in this range,<br />
The second number, when multiplied by 4 is the offset to the iomuxc control register (starting at 20E_0000h) <br />
the third number is the number of pins in this range.</p>

<p>Take gpio1 for example:</p>

<p><code class="highlighter-rouge">gpio-ranges = &lt;&amp;iomuxc  0 23 10&gt;, &lt;&amp;iomuxc 10 17 6&gt;, &lt;&amp;iomuxc 16 33 16&gt;;</code></p>

<p>Now the GPIO1 registers aren’t contiguous, pins are in 3 ranges.</p>

<p>First group is GPIO1.0 - GPIO1.9 (10pins), base offset = 23 * 4 = 0x5c which is IOMUXC_SW_MUX_CTL_PAD_GPIO1_IO00<br />
Second group is GPIO1.10 - GPIO1.15 (6pins), base offset = 17 * 4 = 0x44 which is IOMUXC_SW_MUX_CTL_PAD_JTAG_MOD<br />
Third group is GPIO1.16 - GPIO1.31 (16pins), base offset = 33 * 4 = 0x84 which is IOMUXC_SW_MUX_CTL_PAD_UART1_TX_DATA</p>

<p><span style="color:red;">Tips:</span></p>



									<br/>
									<h3><i class="fas fa-tags"></i>Post Tags</h3>
									
									<a href=" ../../../../tag/linux/index.html" >Linux</a>
									
									<a href=" ../../../../tag/kernel/index.html" >kernel</a>
									
									<a href=" ../../../../tag/device-tree/index.html" >Device-tree</a>
									
									<head>
<script src='https://unpkg.com/valine/dist/Valine.min.js'></script>
</head>

<div id="vcomments"></div>
<script>
    new Valine({
        el: '#vcomments',
        appId: '9CvJWlMvXQsUUkjcCF0nbtSS-MdYXbMMI',
        appKey: 'KQFufTHJeHucASskKMC6xtLG',
        avatar: 'retro',
        meta: ['nick', 'mail'],
        lang: 'en',
        visitor: true,
        enableQQ:true,
        placeholder: 'Message here.\n (Tips: To make a anonymous comment, nickname and email are not necessary.\n Please entry nickname and email, if you want to show your nickname and get reminder of reply by email. )\n(输入nickname和email，可显示网络名并得到邮件回复提醒。)'
    })
</script>

								</section>
								
								

								

							</div>
						</div>
								

								
								
								

				<!-- Sidebar -->



					<div id="sidebar">
						<div class="inner">

							<!-- Search -->
								<section id="search" class="alt">
									<form method="post" action="#">
										<input type="text" name="query" id="query" placeholder="Search" />
									</form>
								</section>





							<!-- Menu -->
								<nav id="menu">
									<header class="major">
										<h2>Menu</h2>
									</header>
									<ul>
									<li><a href="../../../../index.html">About me</a></li>
									<li>


											<span class="opener">Photograph</span>
											<ul>
												

												<li><a href="../../../../photos/toronto/index.html">toronto</a></li>
												

												<li><a href="../../../../photos/windsor/index.html">windsor</a></li>
												
											</ul>
									</li>	
									</ul>
									<br/>
										
									<header class="major">
									<h2>Tech Blogs</h2>
									</header>	
									<ul>
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										<li>
											<a href="/2020/05/12/robotics.html">Robotics</a><span class="opener" style="font-size: 0.1;"></span>
											<ul>
												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

																						
												
												

												<li><a href="/2019/12/12/formation-control.html">Formation Control</a></li>
												
												
												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												<!--<li><a href="#">Feugiat Veroeros</a></li> -->
											</ul>
										</li>
										
										
										
										
										
										<li>
											<a href="/2020/05/12/programming.html">Programming</a><span class="opener" style="font-size: 0.1;"></span>
											<ul>
												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

																						
												
												

												<li><a href="/2019/12/12/SQL.html"> SQL command and usage </a></li>
												
												
												
												
												

																						
												
												
												
												
												
												

																						
												
												

												<li><a href="/2019/12/12/c_cpp_scope.html"> C/C++ Scope, Storage, and Linkage</a></li>
												
												
												
												
												

																						
												
												

												<li><a href="/2019/12/12/c_cpp_STL.html"> C/C++ Scope, Storage, and Linkage</a></li>
												
												
												
												
												

												
												
												

												
												
												<!--<li><a href="#">Feugiat Veroeros</a></li> -->
											</ul>
										</li>
										
										
										
										
										
										<li>
											<a href="/2020/05/12/mcu.html">Mcu&Mpu</a><span class="opener" style="font-size: 0.1;"></span>
											<ul>
												
												
												

																						
												
												

												<li><a href="/2020/07/04/driver-framework.html">Linux -- Driver framework</a></li>
												
												
												
												
												

												
												
												

												
												
												

												
												
												

																						
												
												

												<li><a href="/2020/06/12/Uboot.html">Uboot porting with NXP MX serie</a></li>
												
												
												
												
												

																						
												
												

												<li><a href="/2020/05/25/kernel-dts.html">Linux DTB -- device tree</a></li>
												
												
												
												
												

																						
												
												

												<li><a href="/2020/05/25/kernel.html">Linux kernel module beginning (I)</a></li>
												
												
												
												
												

																						
												
												

												<li><a href="/2020/05/25/embedded_linux.html">Embedded linux system architecture</a></li>
												
												
												
												
												

																						
												
												

												<li><a href="/2020/05/22/interrupt.html">Interrupt of ARM A7</a></li>
												
												
												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												<!--<li><a href="#">Feugiat Veroeros</a></li> -->
											</ul>
										</li>
										
										
										
										
										
										<li>
											<a href="/2020/05/12/Machine-Vision.html">Machine Vision</a><span class="opener" style="font-size: 0.1;"></span>
											<ul>
												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

																						
												
												

												<li><a href="/2019/12/12/QRcode.html">Usage of QR code in ROS</a></li>
												
												
												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												<!--<li><a href="#">Feugiat Veroeros</a></li> -->
											</ul>
										</li>
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
										
												
												

												
												
												

																						
												
												
												
												

																						
												
												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

																						
												
												
												
												

																						
												
												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												

												
												
												<!--<li><a href="#">Feugiat Veroeros</a></li> -->
											</ul>
										</li>
										
										
										
										
										
										<br/>
										<!--<li><a href="elements.html">Elements</a></li>-->
										<!--<li><a href="elements.html">Elements</a></li>-->
										
										
									</ul>

									<div>
										<h3><a href=" "><i class="fas fa-tags"></i>Tags</h3></a>
									</div>
									
									
									
									
									

									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/c++/index.html" style="font-size: 11.5pt; color: #777;">C++</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/中文/index.html" style="font-size: 13.5pt; color: #444;">中文</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/sql/index.html" style="font-size: 9pt; color: #999;">SQL</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/ros/index.html" style="font-size: 11.5pt; color: #777;">ROS</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/robotics/index.html" style="font-size: 9pt; color: #999;">Robotics</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/localization/index.html" style="font-size: 11.5pt; color: #777;">Localization</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/formation-control/index.html" style="font-size: 9pt; color: #999;">Formation-control</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/qrcode/index.html" style="font-size: 9pt; color: #999;">QRcode</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/camera-model/index.html" style="font-size: 9pt; color: #999;">Camera-model</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/notes/index.html" style="font-size: 18pt; color: #000;">Notes</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/arm/index.html" style="font-size: 9pt; color: #999;">ARM</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/interrupt/index.html" style="font-size: 9pt; color: #999;">interrupt</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/bare-metal/index.html" style="font-size: 9pt; color: #999;">bare-metal</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/linux/index.html" style="font-size: 18pt; color: #000;">Linux</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/uboot/index.html" style="font-size: 11.5pt; color: #777;">Uboot</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/dirver/index.html" style="font-size: 11.5pt; color: #777;">Dirver</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/kernel/index.html" style="font-size: 13.5pt; color: #444;">kernel</a>
									  
									
									  
									  
									  
									  
									  

									  
									  <a href=" ../../../../tag/device-tree/index.html" style="font-size: 11.5pt; color: #777;">Device-tree</a>
									  
									
									

								</nav>


								<!-- 
								

								
								 
								  
								    <a href="/2020/05/22/interrupt.html">ARM</a>
								  
								  
								
								 
								  
								    <a href="/2019/12/12/c_cpp_scope.html">C++</a>
								  
								    <a href="/2019/12/12/c_cpp_STL.html">C++</a>
								  
								  
								
								 
								  
								    <a href="/2019/12/12/QRcode.html">Camera-model</a>
								  
								  
								
								 
								  
								    <a href="/2020/07/04/driver-framework.html">Device-tree</a>
								  
								    <a href="/2020/05/25/kernel-dts.html">Device-tree</a>
								  
								  
								
								 
								  
								    <a href="/2020/05/25/kernel.html">Dirver</a>
								  
								    <a href="/2020/05/25/embedded_linux.html">Dirver</a>
								  
								  
								
								 
								  
								    <a href="/2019/12/12/formation-control.html">Formation-control</a>
								  
								  
								
								 
								  
								    <a href="/2020/07/04/driver-framework.html">Linux</a>
								  
								    <a href="/2020/06/12/Uboot.html">Linux</a>
								  
								    <a href="/2020/05/25/kernel-dts.html">Linux</a>
								  
								    <a href="/2020/05/25/kernel.html">Linux</a>
								  
								    <a href="/2020/05/25/embedded_linux.html">Linux</a>
								  
								  
								
								 
								  
								    <a href="/2019/12/12/QRcode.html">Localization</a>
								  
								    <a href="/2019/12/12/formation-control.html">Localization</a>
								  
								  
								
								 
								  
								    <a href="/chinese/linux_command.html">Notes</a>
								  
								    <a href="/chinese/dts.html">Notes</a>
								  
								    <a href="/chinese/linux_bug.html">Notes</a>
								  
								    <a href="/2020/05/12/knowledge.html">Notes</a>
								  
								    <a href="/2020/05/12/Cricuit.html">Notes</a>
								  
								  
								
								 
								  
								    <a href="/2019/12/12/QRcode.html">QRcode</a>
								  
								  
								
								 
								  
								    <a href="/2019/12/12/QRcode.html">ROS</a>
								  
								    <a href="/2019/12/12/formation-control.html">ROS</a>
								  
								  
								
								 
								  
								    <a href="/2019/12/12/formation-control.html">Robotics</a>
								  
								  
								
								 
								  
								    <a href="/2019/12/12/SQL.html">SQL</a>
								  
								  
								
								 
								  
								    <a href="/2020/06/12/Uboot.html">Uboot</a>
								  
								    <a href="/2020/05/25/embedded_linux.html">Uboot</a>
								  
								  
								
								 
								  
								    <a href="/2020/05/22/interrupt.html">bare-metal</a>
								  
								  
								
								 
								  
								    <a href="/2020/05/22/interrupt.html">interrupt</a>
								  
								  
								
								 
								  
								    <a href="/2020/07/04/driver-framework.html">kernel</a>
								  
								    <a href="/2020/05/25/kernel-dts.html">kernel</a>
								  
								    <a href="/2020/05/25/kernel.html">kernel</a>
								  
								  
								
								 
								  
								    <a href="/chinese/dts.html">中文</a>
								  
								    <a href="/2020/05/12/knowledge.html">中文</a>
								  
								    <a href="/chinese/C_Cpp_scope.html">中文</a>
								  
								  
								 -->
							
							<!-- Footer -->
								<footer id="footer">
									<p class="copyright">&copy; Jietang. All rights reserved.</p>
								</footer>

						</div>
					</div>

			</div>

		<!-- Scripts -->
			<script src="../../../../assets/js/jquery.min.js"></script>
			<script src="../../../../assets/js/browser.min.js"></script>
			<script src="../../../../assets/js/breakpoints.min.js"></script>
			<script src="../../../../assets/js/util.js"></script>
			<script src="../../../../assets/js/main.js"></script>

	</body>
</html>